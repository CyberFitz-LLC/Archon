From 89e275d9fb68517556a721d6a21406effc29085a Mon Sep 17 00:00:00 2001
From: John Fitzpatrick <john@cyberfitz.org>
Date: Sat, 16 Aug 2025 00:29:24 -0700
Subject: [PATCH 38/38] feat: enhance progress callback compatibility and
 finalize Ollama implementation
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- Add **kwargs support to doc_storage_callback for enhanced progress reporting
- Improve compatibility between progress callback functions
- Complete database persistence and load balancing implementation for Ollama instances

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
---
 python/src/server/services/crawling/crawling_service.py | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/python/src/server/services/crawling/crawling_service.py b/python/src/server/services/crawling/crawling_service.py
index b450375..ec4c539 100644
--- a/python/src/server/services/crawling/crawling_service.py
+++ b/python/src/server/services/crawling/crawling_service.py
@@ -322,7 +322,9 @@ class CrawlingService:
             self._check_cancellation()
             
             # Process and store documents using document storage operations
-            async def doc_storage_callback(message: str, percentage: int, batch_info: Optional[dict] = None):
+            async def doc_storage_callback(
+                message: str, percentage: int, batch_info: Optional[dict] = None, **kwargs
+            ):
                 if self.progress_id:
                     _ensure_socketio_imports()
                     # Map percentage to document storage range (20-85%)
@@ -340,6 +342,9 @@ class CrawlingService:
                     if batch_info:
                         self.progress_state.update(batch_info)
                     
+                    # Add any additional kwargs to progress state for compatibility
+                    if kwargs:
+                        self.progress_state.update(kwargs)
                     await update_crawl_progress(self.progress_id, self.progress_state)
             
             storage_results = await self.doc_storage_ops.process_and_store_documents(
-- 
2.39.5

